<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Frequently-Asked Questions · doobie</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content='docs'/>
<link rel="canonical" href="https://github.com/typelevel/doobiedocs/17-FAQ.html"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:100normal,100italic,300normal,300italic,400normal,400italic,500normal,500italic,700normal,700italic,900normal,900italicc" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/warnOldVersion.js"></script>
<script type="text/javascript" src="../js/groups.js"></script>
<script type="text/javascript" src="../js/snippets.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="../css/page.css"/>

<!--
<link rel="shortcut icon" href="../images/favicon.ico" />
-->
</head>

<body>
<div class="off-canvas-wrapper">
<div class="off-canvas-wrapper-inner" data-off-canvas-wrapper>

<div class="off-canvas position-left" id="off-canvas-menu" data-off-canvas>
<nav class="off-canvas-nav">
<div class="nav-home">
<a href="../index.html" >
<span class="home-icon">⌂</span>doobie
</a>
<div class="version-number">
1.0.0-RC7
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../infographic.html" class="page">Infographic</a></li>
  <li><a href="../migration.html" class="page">Migration Notes</a></li>
  <li><a href="../docs/index.html" class="page">Book of Doobie</a>
  <ul>
    <li><a href="../docs/01-Introduction.html" class="page">Introduction</a></li>
    <li><a href="../docs/02-Toolkit.html" class="page">Toolkit</a></li>
    <li><a href="../docs/03-Connecting.html" class="page">Connecting to a Database</a></li>
    <li><a href="../docs/04-Selecting.html" class="page">Selecting Data</a></li>
    <li><a href="../docs/05-Parameterized.html" class="page">Parameterized Queries</a></li>
    <li><a href="../docs/06-Checking.html" class="page">Typechecking Queries</a></li>
    <li><a href="../docs/07-Updating.html" class="page">DDL, Inserting, and Updating</a></li>
    <li><a href="../docs/08-Fragments.html" class="page">Statement Fragments</a></li>
    <li><a href="../docs/09-Error-Handling.html" class="page">Error Handling</a></li>
    <li><a href="../docs/10-Logging.html" class="page">Logging</a></li>
    <li><a href="../docs/11-Arrays.html" class="page">SQL Arrays</a></li>
    <li><a href="../docs/12-Custom-Mappings.html" class="page">Custom Mappings</a></li>
    <li><a href="../docs/13-Unit-Testing.html" class="page">Unit Testing</a></li>
    <li><a href="../docs/14-Managing-Connections.html" class="page">Managing Connections</a></li>
    <li><a href="../docs/15-Extensions-PostgreSQL.html" class="page">Extensions for PostgreSQL</a></li>
    <li><a href="../docs/16-Extensions-H2.html" class="page">Extensions for H2</a></li>
    <li><a href="../docs/17-FAQ.html" class="active page">Frequently-Asked Questions</a></li>
    <li><a href="../docs/18-Related-Projects.html" class="page">Related Projects</a></li>
  </ul></li>
</ul>
</div>

</nav>
</div>

<div class="off-canvas-content" data-off-canvas-content>

<header class="site-header expanded row">
<div class="small-12 column">
<a href="#" class="off-canvas-toggle hide-for-medium" data-toggle="off-canvas-menu"><svg class="svg-icon svg-icon-menu" version="1.1" id="Menu" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"> <path class="svg-icon-menu-path" fill="#53CDEC" d="M16.4,9H3.6C3.048,9,3,9.447,3,10c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,9.447,16.952,9,16.4,9z M16.4,13
H3.6C3.048,13,3,13.447,3,14c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,13.447,16.952,13,16.4,13z M3.6,7H16.4
C16.952,7,17,6.553,17,6c0-0.553-0.048-1-0.6-1H3.6C3.048,5,3,5.447,3,6C3,6.553,3.048,7,3.6,7z"/></svg>
</a>
<div class="title"><a href="../index.html">doobie</a></div>

<!--
<a href="https://www.example.com" class="logo show-for-medium">logo</a>
-->
</div>
</header>

<div class="expanded row">

<div class="medium-3 large-2 show-for-medium column">
<nav class="site-nav">
<div class="nav-home">
<a href="../index.html" >
<span class="home-icon">⌂</span>doobie
</a>
<div class="version-number">
1.0.0-RC7
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../infographic.html" class="page">Infographic</a></li>
  <li><a href="../migration.html" class="page">Migration Notes</a></li>
  <li><a href="../docs/index.html" class="page">Book of Doobie</a>
  <ul>
    <li><a href="../docs/01-Introduction.html" class="page">Introduction</a></li>
    <li><a href="../docs/02-Toolkit.html" class="page">Toolkit</a></li>
    <li><a href="../docs/03-Connecting.html" class="page">Connecting to a Database</a></li>
    <li><a href="../docs/04-Selecting.html" class="page">Selecting Data</a></li>
    <li><a href="../docs/05-Parameterized.html" class="page">Parameterized Queries</a></li>
    <li><a href="../docs/06-Checking.html" class="page">Typechecking Queries</a></li>
    <li><a href="../docs/07-Updating.html" class="page">DDL, Inserting, and Updating</a></li>
    <li><a href="../docs/08-Fragments.html" class="page">Statement Fragments</a></li>
    <li><a href="../docs/09-Error-Handling.html" class="page">Error Handling</a></li>
    <li><a href="../docs/10-Logging.html" class="page">Logging</a></li>
    <li><a href="../docs/11-Arrays.html" class="page">SQL Arrays</a></li>
    <li><a href="../docs/12-Custom-Mappings.html" class="page">Custom Mappings</a></li>
    <li><a href="../docs/13-Unit-Testing.html" class="page">Unit Testing</a></li>
    <li><a href="../docs/14-Managing-Connections.html" class="page">Managing Connections</a></li>
    <li><a href="../docs/15-Extensions-PostgreSQL.html" class="page">Extensions for PostgreSQL</a></li>
    <li><a href="../docs/16-Extensions-H2.html" class="page">Extensions for H2</a></li>
    <li><a href="../docs/17-FAQ.html" class="active page">Frequently-Asked Questions</a></li>
    <li><a href="../docs/18-Related-Projects.html" class="page">Related Projects</a></li>
  </ul></li>
</ul>
</div>

</nav>
</div>

<div class="small-12 medium-9 large-10 column">
<section class="site-content">

<span id="version-warning"></span>

<div class="page-header row">
<div class="medium-12 show-for-medium column">
<div class="nav-breadcrumbs">
<ul>
  <li><a href="../index.html">doobie</a></li>
  <li><a href="../docs/index.html">Book of Doobie</a></li>
  <li>Frequently-Asked Questions</li>
</ul>
</div>
</div>
</div>

<div class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h2><a href="#frequently-asked-questions" name="frequently-asked-questions" class="anchor"><span class="anchor-link"></span></a>Frequently-Asked Questions</h2>
<p>In this chapter we address some frequently-asked questions, in no particular order. First a bit of set-up.</p>
<pre class="prettyprint"><code class="language-scala">import cats._
import cats.data._
import cats.effect._
import cats.effect.implicits._
import cats.implicits._
import doobie._
import doobie.implicits._
import doobie.util.ExecutionContexts
import java.awt.geom.Point2D
import java.util.UUID
import shapeless._

// This is just for testing. Consider using cats.effect.IOApp instead of calling
// unsafe methods directly.
import cats.effect.unsafe.implicits.global

// A transactor that gets connections from java.sql.DriverManager.
// See the chapter on connection handling for more info.
val xa = Transactor.fromDriverManager[IO](
  driver = &quot;org.postgresql.Driver&quot;,  // JDBC driver classname
  url = &quot;jdbc:postgresql:world&quot;,     // Connect URL - Driver specific
  user = &quot;postgres&quot;,                 // Database user name
  password = &quot;password&quot;,             // Database password
  logHandler = None                  // Don&#39;t setup logging for now. See Logging page for how to log events in detail
)
</code></pre>
<h3><a href="#how-do-i-do-an-in-clause-" name="how-do-i-do-an-in-clause-" class="anchor"><span class="anchor-link"></span></a>How do I do an <code>IN</code> clause?</h3>
<p>See the section on <code>IN</code> clauses in <a href="05-Parameterized.html">Chapter 5</a> and <a href="08-Fragments.html">Chapter 8</a> on statement fragments.</p>
<h3><a href="#how-do-i-ascribe-an-sql-type-to-an-interpolated-parameter-" name="how-do-i-ascribe-an-sql-type-to-an-interpolated-parameter-" class="anchor"><span class="anchor-link"></span></a>How do I ascribe an SQL type to an interpolated parameter?</h3>
<p>Interpolated parameters are replaced with <code>?</code> placeholders, so if you need to ascribe an SQL type you can use vendor-specific syntax in conjunction with the interpolated value. For example, in PostgreSQL you use <code>:: type</code>:</p>
<pre class="prettyprint"><code class="language-scala">{
  val y = xa.yolo
  import y._
  val s = &quot;foo&quot;
  sql&quot;select $s&quot;.query[String].check.unsafeRunSync()
  sql&quot;select $s :: char&quot;.query[String].check.unsafeRunSync()
}
</code></pre>
<h3><a href="#how-do-i-do-several-things-in-the-same-transaction-" name="how-do-i-do-several-things-in-the-same-transaction-" class="anchor"><span class="anchor-link"></span></a>How do I do several things in the same transaction?</h3>
<p>You can use a <code>for</code> comprehension to compose any number of <code>ConnectionIO</code> programs, and then call <code>.transact(xa)</code> on the result. All of the composed programs will run in the same transaction. For this reason it&rsquo;s useful for your APIs to expose values in <code>ConnectionIO</code>, so higher-level code can place transaction boundaries as needed.</p>
<h3><a href="#how-do-i-run-something-outside-of-a-transaction-" name="how-do-i-run-something-outside-of-a-transaction-" class="anchor"><span class="anchor-link"></span></a>How do I run something outside of a transaction?</h3>
<p><code>Transactor.transact</code> takes a <code>ConnectionIO</code> and constructs an <code>IO</code> or similar that will run it in a single transaction, but it is also possible to include transaction boundaries <em>within</em> a <code>ConnectionIO</code>, and to disable transaction handling altogether. Some kinds of DDL statements may require this for some databases. You can define a combinator to do this for you.</p>
<pre class="prettyprint"><code class="language-scala">/**
 * Take a program `p` and return an equivalent one that first commits
 * any ongoing transaction, runs `p` without transaction handling, then
 * starts a new transaction.
 */
def withoutTransaction[A](p: ConnectionIO[A]): ConnectionIO[A] =
  FC.setAutoCommit(true).bracket(_ =&gt; p)(_ =&gt; FC.setAutoCommit(false))
</code></pre>
<p>Note that you need both of these operations if you are using a <code>Transactor</code> because it will always start a transaction and will try to commit on completion.</p>
<h3><a href="#how-do-i-turn-an-arbitrary-sql-string-into-a-query0-update0-" name="how-do-i-turn-an-arbitrary-sql-string-into-a-query0-update0-" class="anchor"><span class="anchor-link"></span></a>How do I turn an arbitrary SQL string into a <code>Query0/Update0</code>?</h3>
<pre class="prettyprint"><code class="language-scala">case class Code(country: String)
case class City(code: Code, name: String, population: Int)

def cities(code: Code, asc: Boolean): Query0[City] = {
  val ord = if (asc) fr&quot;ASC&quot; else fr&quot;DESC&quot;
  val sql = fr&quot;&quot;&quot;
    SELECT countrycode, name, population
    FROM   city
    WHERE  countrycode = $code
    ORDER BY name&quot;&quot;&quot; ++ ord
  sql.query[City]
}
</code></pre>
<p>We can check the resulting <code>Query0</code> as expected.</p>
<pre class="prettyprint"><code class="language-scala">{
  val y = xa.yolo
  import y._
  cities(Code(&quot;USA&quot;), true).check.unsafeRunSync()
}
</code></pre>
<p>And it works!</p>
<pre class="prettyprint"><code class="language-scala">{
  val y = xa.yolo
  import y._
  cities(Code(&quot;USA&quot;), true).stream.take(5).quick.unsafeRunSync()
  cities(Code(&quot;USA&quot;), false).stream.take(5).quick.unsafeRunSync()
}
</code></pre>
<h3><a href="#how-do-i-handle-outer-joins-" name="how-do-i-handle-outer-joins-" class="anchor"><span class="anchor-link"></span></a>How do I handle outer joins?</h3>
<p>With an outer join you end up with set of nullable columns, which you typically want to map to a single <code>Option</code> of some composite type, which doobie can do for you. If all columns are null you will get back <code>None</code>.</p>
<pre class="prettyprint"><code class="language-scala">case class Country(name: String, code: String)
case class City2(name: String, district: String)

val join =
  sql&quot;&quot;&quot;
    select c.name, c.code,
           k.name, k.district
    from country c
    left outer join city k
    on c.capital = k.id
  &quot;&quot;&quot;.query[(Country, Option[City2])]
</code></pre>
<p>Some examples, filtered for size.</p>
<pre class="prettyprint"><code class="language-scala">{
  val y = xa.yolo
  import y._
  join.stream.filter(_._1.name.startsWith(&quot;United&quot;)).quick.unsafeRunSync()
}
</code></pre>
<h3><a href="#how-do-i-log-the-sql-produced-for-my-query-after-interpolation-" name="how-do-i-log-the-sql-produced-for-my-query-after-interpolation-" class="anchor"><span class="anchor-link"></span></a>How do I log the SQL produced for my query after interpolation?</h3>
<p>See <a href="10-Logging.html">Chapter 10</a>.</p>
<h3><a href="#why-is-there-no-get-or-put-for-sqlxml-" name="why-is-there-no-get-or-put-for-sqlxml-" class="anchor"><span class="anchor-link"></span></a>Why is there no <code>Get</code> or <code>Put</code> for <code>SQLXML</code>?</h3>
<p>There are a lot of ways to handle <code>SQLXML</code> so there is no pre-defined strategy, but here is one that maps <code>scala.xml.Elem</code> to <code>SQLXML</code> via streaming.</p>
<pre class="prettyprint"><code class="language-scala">import doobie.enumerated.JdbcType.Other
import java.sql.SQLXML
import scala.xml.{ XML, Elem }

implicit val XmlMeta: Meta[Elem] =
  Meta.Advanced.one[Elem](
    Other,
    NonEmptyList.of(&quot;xml&quot;),
    (rs, n) =&gt; XML.load(rs.getObject(n).asInstanceOf[SQLXML].getBinaryStream),
    (ps, n,  e) =&gt; {
      val sqlXml = ps.getConnection.createSQLXML
      val osw = new java.io.OutputStreamWriter(sqlXml.setBinaryStream)
      XML.write(osw, e, &quot;UTF-8&quot;, false, null)
      osw.close
      ps.setObject(n, sqlXml)
    },
    (_, _,  _) =&gt; sys.error(&quot;update not supported, sorry&quot;)
  )
</code></pre>
<h2><a href="#how-do-i-set-the-chunk-size-for-streaming-results-" name="how-do-i-set-the-chunk-size-for-streaming-results-" class="anchor"><span class="anchor-link"></span></a>How do I set the chunk size for streaming results?</h2>
<p>By default streams constructed with the <code>sql</code> interpolator are fetched <code>Query.DefaultChunkSize</code> rows at a time (currently 512). If you wish to change this chunk size you can use <code>streamWithChunkSize</code> for queries, and <code>withGeneratedKeysWithChunkSize</code> for updates that return results.</p>
<h2><a href="#my-postgres-domains-are-all-type-checking-as-distinct-how-can-i-get-my-yolo-tests-to-pass-" name="my-postgres-domains-are-all-type-checking-as-distinct-how-can-i-get-my-yolo-tests-to-pass-" class="anchor"><span class="anchor-link"></span></a>My Postgres domains are all type checking as DISTINCT! How can I get my Yolo tests to pass?</h2>
<p>Domains with check constraints will type check as DISTINCT. For Doobie later than 0.4.4, in order to get the type checks to pass, you can define a <code>Meta</code> of with target type Distinct and <code>xmap</code> that instances. For example,</p>
<pre class="prettyprint"><code class="language-scala">import cats.data.NonEmptyList
import doobie._
import doobie.enumerated.JdbcType

object distinct {

  def string(name: String): Meta[String] =
    Meta.Advanced.many(
      NonEmptyList.of(JdbcType.Distinct, JdbcType.VarChar),
      NonEmptyList.of(name),
      _ getString _,
      _.setString(_, _),
      _.updateString(_, _)
    )
}

case class NonEmptyString(value: String)

// If the domain for NonEmptyStrings is nes
implicit val nesMeta: Meta[NonEmptyString] = {
  distinct.string(&quot;nes&quot;).imap(NonEmptyString.apply)(_.value)
}
</code></pre>
<h2><a href="#how-do-i-use-java-time-types-with-doobie-" name="how-do-i-use-java-time-types-with-doobie-" class="anchor"><span class="anchor-link"></span></a>How do I use <code>java.time</code> types with Doobie?</h2>
<p>The following imports will provide <code>Meta</code> instances for common java.time.* types:</p>
<table>
  <thead>
    <tr>
      <th>Database driver </th>
      <th>Import </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Postgres (org.postgresql.Driver) </td>
      <td><code>doobie.postgres.implicits.*</code> </td>
    </tr>
    <tr>
      <td>MySQL (com.mysql.jdbc.Driver) </td>
      <td><code>doobie.mysql.implicits.*</code> </td>
    </tr>
  </tbody>
</table>
<p>For other databases, if your JDBC driver supports the java.time types natively, you can use <code>import doobie.implicits.javatimedrivernative._</code>.</p>
<p>References:</p>
<ul>
  <li><a href="https://jdbc.postgresql.org/documentation/query/#using-java-8-date-and-time-classes">Postgres JDBC - Using Java 8 Date and Time classes</a></li>
</ul>
<div class="source-github">
The source code for this page can be found <a href="https://github.com/typelevel/doobie/tree/master/modules/docs/target/mdoc/docs/17-FAQ.md">here</a>.
</div>

<div class="nav-next">
<p><strong>Next:</strong> <a href="../docs/18-Related-Projects.html">Related Projects</a></p>
</div>
</div>
<div class="large-3 show-for-large column" data-sticky-container>
<nav class="sidebar sticky" data-sticky data-anchor="docs" data-sticky-on="large">
<div class="page-nav">
<div class="nav-title">On this page:</div>
<div class="nav-toc">
<ul>
  <li><a href="../docs/17-FAQ.html#frequently-asked-questions" class="header">Frequently-Asked Questions</a>
  <ul>
    <li><a href="../docs/17-FAQ.html#how-do-i-do-an-in-clause-" class="header">How do I do an <code>IN</code> clause?</a></li>
    <li><a href="../docs/17-FAQ.html#how-do-i-ascribe-an-sql-type-to-an-interpolated-parameter-" class="header">How do I ascribe an SQL type to an interpolated parameter?</a></li>
    <li><a href="../docs/17-FAQ.html#how-do-i-do-several-things-in-the-same-transaction-" class="header">How do I do several things in the same transaction?</a></li>
    <li><a href="../docs/17-FAQ.html#how-do-i-run-something-outside-of-a-transaction-" class="header">How do I run something outside of a transaction?</a></li>
    <li><a href="../docs/17-FAQ.html#how-do-i-turn-an-arbitrary-sql-string-into-a-query0-update0-" class="header">How do I turn an arbitrary SQL string into a <code>Query0/Update0</code>?</a></li>
    <li><a href="../docs/17-FAQ.html#how-do-i-handle-outer-joins-" class="header">How do I handle outer joins?</a></li>
    <li><a href="../docs/17-FAQ.html#how-do-i-log-the-sql-produced-for-my-query-after-interpolation-" class="header">How do I log the SQL produced for my query after interpolation?</a></li>
    <li><a href="../docs/17-FAQ.html#why-is-there-no-get-or-put-for-sqlxml-" class="header">Why is there no <code>Get</code> or <code>Put</code> for <code>SQLXML</code>?</a></li>
    <li><a href="../docs/17-FAQ.html#how-do-i-set-the-chunk-size-for-streaming-results-" class="header">How do I set the chunk size for streaming results?</a></li>
    <li><a href="../docs/17-FAQ.html#my-postgres-domains-are-all-type-checking-as-distinct-how-can-i-get-my-yolo-tests-to-pass-" class="header">My Postgres domains are all type checking as DISTINCT! How can I get my Yolo tests to pass?</a></li>
    <li><a href="../docs/17-FAQ.html#how-do-i-use-java-time-types-with-doobie-" class="header">How do I use <code>java.time</code> types with Doobie?</a></li>
  </ul></li>
</ul>
</div>
</div>
</nav>
</div>
</div>

</section>
</div>

</div>

<footer class="site-footer">

<section class="site-footer-nav">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 medium-4 large-3 text-center column">
<div class="nav-links">
<ul>
<!-- <li><a href="https://www.example.com/products/">Products</a> -->
</ul>
</div>
</div>

</div>
</div>
</div>
</section>

<section class="site-footer-base">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 text-center large-9 column">

<!--
<div class="copyright">
<span class="text">&copy; 2025</span>
<a href="https://www.example.com" class="logo">logo</a>
</div>
-->
</div>

</div>
</div>
</div>
</section>
</footer>

</div>
</div>
</div>
</body>

<script type="text/javascript" src="../lib/foundation/dist/foundation.min.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/magellan.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>
<script type="text/javascript">jQuery(function(jq){initOldVersionWarnings(jq, '1.0.0-RC7', 'https://github.com/typelevel/doobie')});</script>


</html>
